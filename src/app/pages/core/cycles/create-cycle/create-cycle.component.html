<div class="card">
  <div class="card-header">
    <div class="d-flex justify-content-between">
      <h5>Crear ciclo de {{ course.title }}</h5>
      <app-button-back></app-button-back>
    </div>
  </div>
  <div class="card-body">
    <ng-container *ngIf="load_data">
        <app-loading></app-loading>
    </ng-container>

    <ng-container *ngIf="!load_data">
      <ng-container *ngIf="!data"> NOT FOUND </ng-container>
      <ng-container *ngIf="data">
        <form (ngSubmit)="register()" [formGroup]="myForm" class="row">
          <div class="col-12 col-md-6">
            <div class="mb-3">
              <label class="form-label">Nivel</label>
              <select formControlName="nivel" class="form-control">
                <option value="" selected disabled>Seleccionar Nivel</option>
                <option value="Basico 1">Basico 1</option>
                <option value="Basico 2">Basico 2</option>
                <option value="Basico 3">Basico 3</option>
                <option value="Intermedio 1">Intermedio 1</option>
                <option value="Intermedio 2">Intermedio 2</option>
                <option value="Intermedio 2">Intermedio 3</option>
                <option value="Avanzado 1">Avanzado 1</option>
                <option value="Avanzado 2">Avanzado 2</option>
                <option value="Avanzado 3">Avanzado 3</option>
              </select>
              <small *ngIf="validators('nivel')" class="text-danger"> Este campo es obligatorio. </small>
            </div>
            <div class="mb-3">
              <label class="form-label">Sede</label>
              <select formControlName="sede" class="form-control">
                <option value="" selected disabled>Seleccionar Sede</option>
                <option value="Lima">Lima</option>
                <option value="Arequipa">Arequipa</option>
                <option value="Trujillo">Trujillo</option>
              </select>
              <small *ngIf="validators('sede')" class="text-danger"> Este campo es obligatorio. </small>
            </div>
          </div>
          <div class="col-12 col-md-6">
            <div class="mb-3">
              <label class="form-label">Precio</label>
              <input formControlName="price" type="text" class="form-control" placeholder="Precio mensual" />
              <small *ngIf="validators('price')" class="text-danger"> Este campo es obligatorio. </small>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Fecha inicio</label>
                <input formControlName="start_date" [min]="date | date: 'yyyy-MM-dd'" type="date" class="form-control" />
                <small *ngIf="validators('start_date')" class="text-danger"> Este campo es obligatorio. </small>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Fecha final</label>
                <input formControlName="final_date" [min]="date | date: 'yyyy-MM-dd'" type="date" class="form-control" />
                <small *ngIf="validators('final_date')" class="text-danger"> Este campo es obligatorio. </small>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="d-flex justify-content-between align-items-center py-2">
              <label class="mb-0">Frecuencia Horaria</label>
              <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#standard-modal">Nuevo</button>
            </div>
            <div class="table-responsive">
              <table class="table table-bordered table-sm text-center mb-0">
                <thead>
                  <tr>
                    <th>Salón</th>
                    <th>Aforo</th>
                    <th>Días</th>
                    <th>Horario</th>
                    <th>Quitar</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of frequency; let i = index">
                    <td>{{ item.room }}</td>
                    <td>{{ item.aforo }}</td>
                    <td>
                      <ng-container *ngFor="let subitem of item.frequency; let last = last">
                        <span *ngIf="!last">{{ subitem.substr(0, 3) }}, </span>
                        <span *ngIf="last">{{ subitem.substr(0, 3) }}</span>
                      </ng-container>
                    </td>
                    <td>{{ item.start_time }} - {{ item.final_time }}</td>
                    <td>
                      <a (click)="del_item(i)" class="text-danger"> [Quitar] </a>
                    </td>
                  </tr>
                </tbody>
                <tbody *ngIf="frequency.length == 0">
                  <tr>
                    <td colspan="6" class="text-center">
                      <span class="">No se encontraron resultados</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-12">
            <div class="text-center m-0 mt-4">
              <button *ngIf="frequency.length == 0" disabled class="btn btn-success btn-sm px-5">
                GUARDAR CICLO<i class="fas fa-save ml-2"></i>
              </button>
              <button *ngIf="!load_btn && frequency.length != 0" type="submit" class="btn btn-success btn-sm px-5">
                GUARDAR CICLO<i class="fas fa-save ml-2"></i>
              </button>
              <button *ngIf="load_btn" type="button" class="btn btn-warning btn-sm px-5" disabled>
                GUARDANDO<i class="fas fa-sync fa-spin ml-2"></i>
              </button>
            </div>
          </div>
        </form>
      </ng-container>
    </ng-container>
  </div>
</div>

<div id="standard-modal" class="modal fade">
  <div class="modal-dialog modal-dialog-centered">
      <form  class="modal-content">
      <div class="modal-header">
          <h4 class="modal-title">Registrar Salón</h4>
          <button #closeModal type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <select [(ngModel)]="room.room" name="room" class="form-control">
            <option value="" selected="" disabled>Seleccionar Salón</option>
            <option value="Virtual">Virtual</option>
            <option value="Salon 1">Salon 1</option>
            <option value="Salon 2">Salon 2</option>
            <option value="Salon 3">Salon 3</option>
            <option value="Salon 4">Salon 4</option>
            <option value="Salon 5">Salon 5</option>
          </select>
        </div>
        <div class="mb-3">
          <input [(ngModel)]="room.aforo" name="aforo" type="number" class="form-control" placeholder="Aforo total" />
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label>Hora inicio</label>
            <input [(ngModel)]="room.start_time" name="start_time" type="time" class="form-control" />
          </div>
          <div class="col-md-6 mb-3">
            <label>Hora fin</label>
            <input [(ngModel)]="room.final_time" name="final_time" type="time" class="form-control" />
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <div class="form-check">
              <input (change)="select_day($event)" type="checkbox" id="checkbox1" class="form-check-input" value="Lunes" />
              <label for="checkbox1" class="form-check-label">Lunes</label>
            </div>
            <div class="form-check">
              <input (change)="select_day($event)" type="checkbox" id="checkbox2" class="form-check-input" value="Martes" />
              <label for="checkbox2" class="form-check-label">Martes</label>
            </div>
            <div class="form-check">
              <input (change)="select_day($event)" type="checkbox" id="checkbox3" class="form-check-input" value="Miércoles" />
              <label for="checkbox3" class="form-check-label">Miércoles</label>
            </div>
            <div class="form-check">
              <input (change)="select_day($event)" type="checkbox" id="checkbox4" class="form-check-input" value="Jueves" />
              <label for="checkbox4" class="form-check-label">Jueves</label>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="form-check">
              <input (change)="select_day($event)" type="checkbox" id="checkbox5" class="form-check-input" value="Viernes" />
              <label for="checkbox5" class="form-check-label">Viernes</label>
            </div>
            <div class="form-check">
              <input (change)="select_day($event)" type="checkbox" id="checkbox6" class="form-check-input" value="Sábado" />
              <label for="checkbox6" class="form-check-label">Sábado</label>
            </div>
            <div class="form-check">
              <input (change)="select_day($event)" type="checkbox" id="checkbox7" class="form-check-input" value="Domingo" />
              <label for="checkbox7" class="form-check-label">Domingo</label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cerrar</button>
        <button (click)="add_item()" type="submit" class="btn btn-success">Agregar</button>
      </div>
      </form>
  </div>
</div>
